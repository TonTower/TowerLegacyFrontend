<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/common.css?ver=133" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/fonts.css?ver=133" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/popup.css?ver=133" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/header.css?ver=133" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/footer.css?ver=133" />
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/fontsAll.css"/>
    <link rel="stylesheet" type="text/css" href="https://storage.tower-ton.com/3e21e5c9-towerton/css/TonTowerWallet.css?ver=133" />
    <script src="https://unpkg.com/@tonconnect/ui@2.0.0/dist/tonconnect-ui.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="flex-column">
<section class="ton-tower-treasure mainContentSection">
    <!-- This section contains the main content of the page, including images, titles, and information cards. -->
    <div class="flex_col">
        <div class="flex_col1">
            <div class="content_box13">
                <div class="wrapper16">
                    <div class="flex_col2">
                        <div class="dark">
                            <div class="flex_row">
                                <div class="header">
                                    <div class="left_header">
                                        <div class="content_box8" id="close">
                                            <p data-lang="ru" class="englishLanguageText">EN</p>
                                            <p data-lang="en" style="display: none" class="russianLanguageText">RU</p>
                                        </div>                                        <div class="sound">
                                            <img id="soundImage" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/sound.svg" alt="">
                                        </div>
                                    </div>
                                    <h1 class="heroTitle" id="heroTitle1" data-lang="ru">Башня</h1>
                                    <h1 class="heroTitle" id="heroTitle2" data-lang="en" style="display: none">Tower</h1>
                                    <div class="right_header">
                                        <div class="faq">
                                            <img src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/faq.svg" alt="">
                                        </div>
                                        <div class="content_box9">
                                            <img class="contentImage1" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/wallet.svg" alt="alt text">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex_row1">
                                <div class="content_box10">
                                    <div class="flex_row2">
                                        <img class="floorImage" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/tower-img.svg" alt="alt text" />
                                        <div class="flex_col3">
                                            <p class="floorNumber">{{ level }}</p>
                                            <p class="floorLabel" data-lang="ru">Этаж</p>
                                            <p class="floorLabel" data-lang="en" style="display: none;">Floor</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="content_box11">
                                    <div class="flex_row3">
                                        <img class="ratingImage" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/gold.svg" alt="alt text" />
                                        <div class="flex_col4">
                                            <p class="ratingNumber">{{ points }}</p>
                                            <p class="ratingLabel" data-lang="ru">Рейтинг</p>
                                            <p class="ratingLabel" data-lang="en" style="display: none;">Rating</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="content_box12">
                                    <div class="flex_row4">
                                        <img class="balanceImage" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/bag.png" alt="alt text" />
                                        <div class="flex_col5">
                                            <p class="balanceNumber">{{ balance }}</p>
                                            <p class="balanceLabel">TWR</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="containerMain">
                    <div class="titleSemiBold titleMain" data-lang="ru">
                        Кошелек
                    </div>
                    <div class="titleSemiBold titleMain" data-lang="en" style="display: none;">
                        Wallet
                    </div>
                    <div class="connect_button" id="connectButtonContainer">
                        <button style="padding: 0% 0 0 0%;" id="ton-connect"></button>
                    </div>
                    <div class="union" id="unionBlock" style="display: none;">
                        <button class="connected" data-lang="ru">Подключено</button>
                        <button class="connected" data-lang="en" style="display: none;">Connected</button>
                        <button class="code">xijibvxkbnjxkb</button>
                    </div>
                    <div class="wallet_text greyShell">
                        <p class="textUsual" data-lang="ru">Подключай кошелёк и <span  class="medium">выводи токены</span>  которые выпадают из сундуков.</p>
                        <p class="textUsual" data-lang="en" style="display: none;">Connect the wallet and <span  class="medium"> withdraw the tokens</span> that fall out of the chests.</p>
                        <p class="textUsual" data-lang="ru">Набрав токены необходимые для минимального вывода ты <span  class="medium">получишь их на свой кошелёк.</span></p>
                        <p class="textUsual" data-lang="en" style="display: none;">Having collected the tokens necessary for the minimum withdrawal, you<span  class="medium"> will receive them to your wallet.</span></p>
                        <p class="textUsual" data-lang="ru">После листинга TWR ты сможешь получить часть накопленных <span  class="medium">TWR на свой кошелёк.</span></p>
                        <p class="textUsual" data-lang="en" style="display: none;">After listing TWR, you will be able to receive a portion of the accumulated <span  class="medium"> TWR to your wallet.</span></p>
                    </div>
                </div>

            </div>
            <div class="wrapper">
                <div style="z-index: 3" class="flex_row6">
                    <div class="footer">
                        <div id="HOME" class="content_box3 footer_btn">
                            <div class="footer_gap">
                                <img class="footer_img" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/e712bd402d6f4d66aaeb437e9ed8deed.svg" alt="alt text" />
                                <p class="usualText" data-lang="ru">Башня</p>
                                <p class="usualText" data-lang="en" style="display: none;">Tower</p>
                            </div>
                        </div>
                        <div id="tasks" class="content_box2 footer_btn">
                            <div class="footer_gap">
                                <img class="footer_img" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/b86d07f8991af9dd93ba172bb1db337b.svg" alt="alt text" />
                                <p class="usualText" data-lang="ru">Задания</p>
                                <p class="usualText" data-lang="en" style="display: none;">Tasks</p>
                            </div>
                        </div>
                        <div id="store" class="group footer_btn">
                            <div class="footer_gap">
                                <img class="footer_img" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/chest.svg" alt="alt text" />
                                <p class="usualText" data-lang="ru">Сокровища</p>
                                <p class="usualText" data-lang="en" style="display: none;">Treasures</p>
                            </div>
                        </div>
                        <div id="friends" class="content_box1 footer_btn">
                            <div class="footer_gap">
                                <img class="footer_img" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/7cc12ec41fdfb03ec4c131735d1fc6ea.svg" alt="alt text" />
                                <p class="usualText" data-lang="ru">Друзья</p>
                                <p class="usualText" data-lang="en" style="display: none;">Friends</p>
                            </div>
                        </div>
                        <div id="burse" class="content_box footer_btn">
                            <div class="footer_gap">
                                <img class="footer_img" src="https://storage.tower-ton.com/3e21e5c9-towerton/assets/2228929cf3c4fe7eacbe6ba47d98e4ba.svg" alt="alt text" />
                                <div class="usualText" data-lang="ru">Биржа</div>
                                <div class="usualText" data-lang="en" style="display: none;">Burse</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    const userId = "{{ user_id }}";
    const soundImage = document.getElementById('soundImage');
    document.addEventListener("DOMContentLoaded", async (event) => {
            const response = await fetch('/getlan', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ user_id: userId })
            });
            const data = await response.json();
            lang = data.lang;
            const enTexts = document.querySelectorAll('[data-lang="en"]');
            const ruTexts = document.querySelectorAll('[data-lang="ru"]');
            const currentLang = lang;
            document.documentElement.lang = lang;
            const elements = document.querySelectorAll('[data-lang-en]');
            elements.forEach(element => {
                element.textContent = element.getAttribute(`data-lang-${currentLang}`);
            });
            if (currentLang === "en") {
                enTexts.forEach(text => {
                    text.style.display = 'block';
                });
                ruTexts.forEach(text => {
                    text.style.display = 'none';
                });
            } else {
                enTexts.forEach(text => {
                    text.style.display = 'none';
                });
                ruTexts.forEach(text => {
                    text.style.display = 'block';
                });
            }
            const response6 = await fetch('/get_music', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId })
                });
            const data6 = await response6.json();
            if (data6.music == 0) {
                      soundImage.src = 'https://storage.tower-ton.com/3e21e5c9-towerton/assets/sound_off.svg';
            }
    });



    document.getElementById('HOME').addEventListener('click', () => {
        window.location.href = `/main?user_id=${userId.slice(6, -5)}`;
    });
    document.getElementById('friends').addEventListener('click', () => {
        window.location.href = `/friends?user_id=${userId.slice(6, -5)}`;
    });

    document.getElementById('store').addEventListener('click', () => {
        window.location.href = `/store?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.flex_row4').addEventListener('click', () => {
        window.location.href = `/twr?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.content_box').addEventListener('click', () => {
        window.location.href = `/burse?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.content_box2').addEventListener('click', () => {
        window.location.href = `/tasks?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.content_box9').addEventListener('click', () => {
        window.location.href = `/wallet?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.content_box10').addEventListener('click', () => {
        window.location.href = `/lvlup?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.faq').addEventListener('click', () => {
        window.location.href = `/faq?user_id=${userId.slice(6, -5)}`;
    });
    document.querySelector('.content_box11').addEventListener('click', () => {
        window.location.href = `/rate?user_id=${userId.slice(6, -5)}`;
    });
</script>


<script>

    const headerRow = document.querySelector('.title');
    const tableContainer = document.querySelector('.table-container');

    window.addEventListener('scroll', function() {
        const offset = window.scrollY;

        if (offset > tableContainer.offsetTop) {
            headerRow.classList.add('fixed'); // Добавляем класс фиксированного заголовка
        } else {
            headerRow.classList.remove('fixed'); // Убираем класс, если скролл в верхней части
        }
    });
</script>

<script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://storage.tower-ton.com/3e21e5c9-towerton/tonconnect-manifest.json',
        buttonRootId: 'ton-connect',
        actionsConfiguration: {
            twaReturnUrl: 'https://t.me/TowerTon_bot/Tower'
        }
    });
    tonConnectUI.uiOptions = {
      twaReturnUrl: 'https://t.me/TowerTon_bot/Tower'
    };
    tonConnectUI.connectionRestored.then(restored => {
    if (restored) {
            console.log(
                'Connection restored. Wallet:',
            );
        } else {
            console.log('Connection was not restored.');
        }
    });

</script>

<script>
    soundImage.addEventListener('click', async () => {
      if (soundImage.src.includes('sound.svg')) {
        const response2 = await fetch('/change_music', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: userId })
         });
        const data2 = await response2.json();
        soundImage.src = 'https://storage.tower-ton.com/3e21e5c9-towerton/assets/sound_off.svg';
      } else {
        soundImage.src = 'https://storage.tower-ton.com/3e21e5c9-towerton/assets/sound.svg';
        const response2 = await fetch('/change_music', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: userId })
         });
        const data2 = await response2.json();
      }
    });
</script>
<script>
    document.querySelector('.englishLanguageText').addEventListener('click', async function() {
        const enTexts = document.querySelectorAll('[data-lang="en"]');
        const ruTexts = document.querySelectorAll('[data-lang="ru"]');
        const currentLang = 'en';
        document.documentElement.lang = 'en'
        const response = await fetch('/swaplan', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: userId, lang: document.documentElement.lang  })
        });
        const data = await response.json();
        const elements = document.querySelectorAll('[data-lang-en]');
        elements.forEach(element => {
            element.textContent = element.getAttribute(`data-lang-${currentLang}`);
        });
        enTexts.forEach(text => {
            text.style.display = text.style.display === 'none' ? 'block' : 'none';
        });

        ruTexts.forEach(text => {
            text.style.display = text.style.display === 'none' ? 'block' : 'none';
        });
    });
    document.querySelector('.russianLanguageText').addEventListener('click', async function() {
        const enTexts = document.querySelectorAll('[data-lang="en"]');
        const ruTexts = document.querySelectorAll('[data-lang="ru"]');
        const currentLang = 'ru';
        document.documentElement.lang = 'ru'
        const response = await fetch('/swaplan', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: userId, lang: document.documentElement.lang  })
        });
        const data = await response.json();
        const elements = document.querySelectorAll('[data-lang-en]');
        elements.forEach(element => {
            element.textContent = element.getAttribute(`data-lang-${currentLang}`);
        });
        enTexts.forEach(text => {
            text.style.display = text.style.display === 'none' ? 'block' : 'none';
        });

        ruTexts.forEach(text => {
            text.style.display = text.style.display === 'none' ? 'block' : 'none';
        });
    });

</script>
</body>
</html>